---

- name: Upgrade
  hosts:
    - all
  connection: local
  gather_facts: "no"
  vars:
    main_conf_dir: "{{ playbook_dir }}/.config/upgrade"

  pre_tasks:
    - name: Clear folders
      file:
        path: "{{ playbook_dir }}/.config"
        state: absent
      run_once: True
      changed_when: False
      check_mode: no
      ignore_errors: yes
    - name: Define working directories
      set_fact:
        conf_dir: "{{ main_conf_dir }}/{{ inventory_hostname }}"
      changed_when: False
      check_mode: no
    - name: Recreate folders
      file:
        path: "{{ item }}"
        state: directory
      with_items:
        - "{{ conf_dir }}"
      changed_when: False
      check_mode: no
  tasks:
    - name: Upgrade
      include_role:
        name: upgrade
      when: swi_url is defined and target_version is defined
